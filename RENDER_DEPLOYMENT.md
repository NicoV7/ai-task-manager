# Render Deployment Guide

This guide provides step-by-step instructions for manually deploying the AI Task Manager application on Render using individual services.

## Prerequisites

- Render account (free tier available)
- GitHub repository with your application code
- Basic understanding of environment variables

## Deployment Overview

The application consists of four services:
1. **PostgreSQL Database** - Data storage
2. **Redis Cache** - Session and caching
3. **Django Backend** - API server
4. **React Frontend** - Web application

## Step 1: Create PostgreSQL Database

1. **Login to Render Dashboard**
   - Go to [render.com](https://render.com)
   - Sign in to your account

2. **Create New PostgreSQL Database**
   - Click "New" → "PostgreSQL"
   - Configure the database:
     - **Name**: `taskmanager-db`
     - **Database**: `taskmanager` 
     - **User**: `taskmanager_user`
     - **Region**: Choose closest to your users
     - **Plan**: Free (or Starter for production)

3. **Save Database Connection Details**
   - After creation, note the **Internal Database URL** from the database dashboard
   - You'll need this for the backend service

## Step 2: Create Redis Cache

1. **Create New Redis Instance**
   - Click "New" → "Redis"
   - Configure Redis:
     - **Name**: `taskmanager-redis`
     - **Plan**: Free (25MB) or Starter
     - **Region**: Same as database

2. **Save Redis Connection Details**
   - Note the **Internal Redis URL** from the Redis dashboard
   - You'll need this for the backend service

## Step 3: Deploy Django Backend

1. **Create New Web Service**
   - Click "New" → "Web Service"
   - Connect your GitHub repository
   - Configure the service:
     - **Name**: `taskmanager-backend`
     - **Region**: Same as database/Redis
     - **Branch**: `main` (or your deployment branch)
     - **Root Directory**: `backend`
     - **Runtime**: Docker
     - **Plan**: Free (or Starter for production)

2. **Configure Build Settings**
   - **Docker Command**: Leave empty (uses Dockerfile.prod)
   - **Dockerfile Path**: `Dockerfile.prod`

3. **Set Environment Variables**
   Add the following environment variables in the Render dashboard:

   ```bash
   # Django Configuration
   DJANGO_SETTINGS_MODULE=taskmanager.settings.production
   DEBUG=False
   SECRET_KEY=<auto-generated>  # Let Render generate this
   
   # Database Configuration
   DATABASE_URL=<your-postgres-internal-url>  # From Step 1
   
   # Redis Configuration  
   REDIS_URL=<your-redis-internal-url>  # From Step 2
   
   # Security Settings
   ALLOWED_HOSTS=<your-backend-url>.onrender.com,localhost,127.0.0.1
   SECURE_SSL_REDIRECT=True
   SESSION_COOKIE_SECURE=True
   CSRF_COOKIE_SECURE=True
   
   # CORS Settings
   CORS_ALLOWED_ORIGINS=https://<your-frontend-url>.onrender.com,http://localhost:3000
   
   # Server Configuration
   GUNICORN_WORKERS=2
   LOG_LEVEL=INFO
   
   # AI Integration
   CLAUDE_API_KEY=<your-anthropic-api-key>
   ```

4. **Configure Health Check**
   - **Health Check Path**: `/health/`

5. **Deploy Backend**
   - Click "Create Web Service"
   - Wait for deployment to complete (~5-10 minutes)
   - Verify the service is healthy

## Step 4: Deploy React Frontend

### Option A: Static Site (Recommended)

1. **Create New Static Site**
   - Click "New" → "Static Site"
   - Connect your GitHub repository
   - Configure the site:
     - **Name**: `taskmanager-frontend`
     - **Branch**: `main`
     - **Root Directory**: `frontend`
     - **Build Command**: `npm ci && npm run build`
     - **Publish Directory**: `build`

2. **Set Environment Variables**
   ```bash
   # API Configuration
   REACT_APP_API_URL=https://<your-backend-url>.onrender.com
   REACT_APP_WS_URL=wss://<your-backend-url>.onrender.com
   GENERATE_SOURCEMAP=false
   NODE_ENV=production
   ```

### Option B: Web Service (Alternative)

1. **Create New Web Service**
   - Follow similar steps as backend
   - **Root Directory**: `frontend`
   - **Runtime**: Node
   - **Build Command**: `npm ci && npm run build`
   - **Start Command**: `npm run serve`

2. **Set same environment variables as Option A**

## Step 5: Final Configuration

1. **Update CORS Settings**
   - Go back to your backend service
   - Update `CORS_ALLOWED_ORIGINS` with your actual frontend URL:
     ```bash
     CORS_ALLOWED_ORIGINS=https://<actual-frontend-url>.onrender.com
     ```

2. **Update ALLOWED_HOSTS**
   - Update `ALLOWED_HOSTS` with your actual backend URL:
     ```bash
     ALLOWED_HOSTS=<actual-backend-url>.onrender.com,localhost,127.0.0.1
     ```

3. **Test the Application**
   - Visit your frontend URL
   - Test user registration/login
   - Create and manage tasks
   - Verify AI features work (if Claude API key is configured)

## Step 6: Domain Configuration (Optional)

1. **Custom Domain for Frontend**
   - In Static Site settings → "Custom Domains"
   - Add your domain (e.g., `app.yourdomain.com`)
   - Configure DNS CNAME record

2. **Custom Domain for Backend**
   - In Web Service settings → "Custom Domains"  
   - Add your API domain (e.g., `api.yourdomain.com`)
   - Update CORS_ALLOWED_ORIGINS and frontend REACT_APP_API_URL

## Monitoring and Maintenance

### Logs and Monitoring
- Access service logs from each service's dashboard
- Monitor resource usage and performance
- Set up alerts for service failures

### Database Backups
- Render automatically backs up PostgreSQL databases
- Free tier: 7 days retention
- Paid tiers: 30+ days retention

### Updates and Deployments
- Auto-deploy is enabled by default for connected GitHub repos
- Manual deployment available from service dashboards
- Use environment variables for configuration changes

## Troubleshooting

### Common Issues

1. **Backend Won't Start**
   - Check logs for detailed error messages
   - Verify DATABASE_URL and REDIS_URL are correct
   - Ensure all required environment variables are set

2. **CORS Errors**
   - Verify CORS_ALLOWED_ORIGINS includes your frontend URL
   - Check that URLs don't have trailing slashes

3. **Database Connection Issues**
   - Confirm DATABASE_URL format is correct
   - Check that PostgreSQL service is running
   - Verify network connectivity between services

4. **Static Files Not Loading**
   - Ensure ALLOWED_HOSTS includes your backend domain
   - Check that collectstatic runs successfully in build logs

### Useful Commands for Debugging

```bash
# View recent logs
render logs <service-id>

# Manual deployment trigger
render deploy <service-id>

# Shell access (for web services)
render shell <service-id>
```

## Cost Considerations

### Free Tier Limits
- **Web Services**: 750 hours/month, sleeps after 15min inactivity
- **PostgreSQL**: 1GB storage, 500MB RAM
- **Redis**: 25MB storage
- **Static Sites**: 100GB bandwidth/month

### Scaling Recommendations
- **Production**: Use Starter plans ($7/month) for better performance
- **High Traffic**: Consider Pro plans with autoscaling
- **Database**: Upgrade when approaching storage limits

## Security Best Practices

1. **Environment Variables**
   - Never commit secrets to Git
   - Use Render's built-in secret management
   - Rotate API keys regularly

2. **HTTPS/SSL**
   - Render provides free SSL certificates
   - Enforce HTTPS in Django settings
   - Set secure cookie flags

3. **Database Security**
   - Use strong passwords
   - Limit database access to internal services only
   - Regular backups and monitoring

## Support Resources

- [Render Documentation](https://render.com/docs)
- [Django Deployment Guide](https://docs.djangoproject.com/en/stable/howto/deployment/)
- [React Build Guide](https://create-react-app.dev/docs/production-build/)

---

**Note**: Replace `<placeholders>` with your actual service URLs and configuration values during setup.