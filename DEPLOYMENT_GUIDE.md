# Deploying to Render

This guide walks you through deploying the AI Task Manager application to Render.com, a modern cloud platform that makes deployment straightforward.

## What You'll Need

Before starting the deployment, make sure you have:

1. A Render account (sign up at [render.com](https://render.com) if you don't have one)
2. Your code pushed to a GitHub repository
3. A Claude API key from the [Anthropic Console](https://console.anthropic.com) for AI features

## Choose Your Deployment Method

You can deploy this application in two ways:

### Automatic Deployment (Recommended)
Use the included `render.yaml` blueprint file for one-click deployment. This is faster and ensures all services are configured correctly.

### Manual Deployment
Set up each service individually through the Render dashboard. This gives you more control over each step but takes longer.

---

## Automatic Deployment with Blueprint

### Prepare Your Repository

First, make sure your repository has all the necessary deployment files:

1. Check that these files are in your repository:
   - `render.yaml`
   - `backend/Dockerfile.prod`
   - `frontend/build.sh`
   - `.env.render` (for reference)

2. Make the build script executable:
   ```bash
   chmod +x frontend/build.sh
   ```

3. Commit and push your changes:
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin main
   ```

### Deploy Using the Blueprint

1. **Sign in to Render**: Go to [render.com](https://render.com) and log into your account

2. **Create a new blueprint**:
   - Click "New +"
   - Select "Blueprint"
   - Connect your GitHub account if you haven't already
   - Choose your repository
   - Render will find the `render.yaml` file automatically

3. **Set up your environment variables**:
   - Add your **CLAUDE_API_KEY** (this is required for AI features)
   - Adjust service names in the blueprint if needed

4. **Start the deployment**: Click "Apply" and Render will create all your services

### After Deployment

Once your services are deployed, you'll need to update a few settings with the actual URLs:

1. **Update service URLs**: In your Render dashboard, update these environment variables with your actual service URLs:
   - Frontend service: `REACT_APP_API_URL=https://your-backend-service.onrender.com`
   - Backend service: `ALLOWED_HOSTS=your-backend-service.onrender.com`
   - Backend service: `CORS_ALLOWED_ORIGINS=https://your-frontend-service.onrender.com`

2. **Test your application**: Visit your frontend URL and make sure everything works as expected

---

## Option B: Manual Deployment

### Step 1: Create PostgreSQL Database

1. **New PostgreSQL Service**:
   - Name: `taskmanager-db`
   - Plan: Starter (or higher)
   - Database Name: `taskmanager`
   - User: `taskmanager_user`

2. **Note the connection details** for use in the backend service

### Step 2: Create Redis Instance

1. **New Redis Service**:
   - Name: `taskmanager-redis`
   - Plan: Starter (or higher)

### Step 3: Deploy Backend Service

1. **New Web Service**:
   - Name: `taskmanager-backend`
   - Environment: Docker
   - Build Command: (leave empty)
   - Start Command: (leave empty)
   - Dockerfile Path: `./backend/Dockerfile.prod`

2. **Environment Variables**:
   ```
   DJANGO_SETTINGS_MODULE=taskmanager.settings.production
   DEBUG=False
   SECRET_KEY=[Generate a secure secret key]
   DATABASE_URL=[Connection string from PostgreSQL service]
   REDIS_URL=[Connection string from Redis service]
   ALLOWED_HOSTS=your-backend-service.onrender.com,localhost,127.0.0.1
   CORS_ALLOWED_ORIGINS=https://your-frontend-service.onrender.com
   CLAUDE_API_KEY=[Your Claude API key]
   SECURE_SSL_REDIRECT=True
   SESSION_COOKIE_SECURE=True
   CSRF_COOKIE_SECURE=True
   GUNICORN_WORKERS=2
   LOG_LEVEL=INFO
   ```

3. **Health Check**: Set to `/health/`

### Step 4: Deploy Frontend Service

1. **New Static Site**:
   - Name: `taskmanager-frontend`
   - Build Command: `cd frontend && chmod +x build.sh && ./build.sh`
   - Publish Directory: `./frontend/build`

2. **Environment Variables**:
   ```
   REACT_APP_API_URL=https://your-backend-service.onrender.com
   REACT_APP_WS_URL=wss://your-backend-service.onrender.com
   GENERATE_SOURCEMAP=false
   ```

3. **Rewrites and Redirects**:
   - Source: `/*`
   - Destination: `/index.html`
   - Action: Rewrite

---

## Environment Variables Reference

### Required Environment Variables

| Variable | Service | Description | Example |
|----------|---------|-------------|---------|
| `CLAUDE_API_KEY` | Backend | Anthropic Claude API key | `sk-ant-api03-...` |
| `SECRET_KEY` | Backend | Django secret key | Auto-generated by Render |
| `DATABASE_URL` | Backend | PostgreSQL connection string | Auto-provided by Render |
| `REDIS_URL` | Backend | Redis connection string | Auto-provided by Render |

### Optional Environment Variables

| Variable | Service | Default | Description |
|----------|---------|---------|-------------|
| `GUNICORN_WORKERS` | Backend | `2` | Number of Gunicorn workers |
| `LOG_LEVEL` | Backend | `INFO` | Logging level |
| `ALLOWED_HOSTS` | Backend | - | Comma-separated list of allowed hosts |
| `CORS_ALLOWED_ORIGINS` | Backend | - | Comma-separated list of allowed CORS origins |

---

## Monitoring and Maintenance

### Health Checks

- **Backend**: `/health/` endpoint provides application health status
- **Database**: Built-in health checks for database connectivity
- **Redis**: Built-in health checks for cache connectivity

### Logs

Access logs through the Render dashboard:
1. Go to your service
2. Click on "Logs" tab
3. Filter by log level if needed

### Scaling

**Backend Service**:
- Adjust `GUNICORN_WORKERS` environment variable
- Upgrade to higher Render plan for more CPU/memory

**Database**:
- Upgrade PostgreSQL plan for more storage/connections
- Consider connection pooling for high traffic

### Backups

**Database Backups**:
- Render automatically backs up PostgreSQL databases
- Configure backup retention in the database settings
- Manual backups can be created through the dashboard

---

## Troubleshooting

### Common Issues

1. **Build Failures**:
   - Check build logs in Render dashboard
   - Verify `package.json` and `requirements.txt` are correct
   - Ensure `frontend/build.sh` has execute permissions

2. **Database Connection Issues**:
   - Verify `DATABASE_URL` environment variable
   - Check if database service is running
   - Review network connectivity between services

3. **CORS Errors**:
   - Update `CORS_ALLOWED_ORIGINS` with correct frontend URL
   - Ensure `ALLOWED_HOSTS` includes backend domain

4. **Static Files Not Loading**:
   - Verify `STATIC_ROOT` and `STATIC_URL` settings
   - Check `collectstatic` command runs successfully
   - Review WhiteNoise configuration

### Getting Help

1. **Render Documentation**: [docs.render.com](https://docs.render.com)
2. **Render Community**: [community.render.com](https://community.render.com)
3. **Django Deployment Guide**: [docs.djangoproject.com](https://docs.djangoproject.com/en/stable/howto/deployment/)

---

## Security Considerations

1. **Environment Variables**: Never commit sensitive data to version control
2. **SSL**: Render automatically provides SSL certificates
3. **CORS**: Configure CORS origins restrictively
4. **Database**: Use strong passwords and limit access
5. **API Keys**: Rotate API keys regularly

---

## Cost Optimization

1. **Start Small**: Use Starter plans initially
2. **Monitor Usage**: Review metrics to optimize resource allocation
3. **Efficient Caching**: Configure Redis properly to reduce database load
4. **Static Assets**: Use Render's CDN for static file delivery

---

## Support

For issues specific to this deployment:
1. Check the troubleshooting section above
2. Review Render service logs
3. Verify environment variables are set correctly
4. Test locally with production settings

For application-specific issues:
- Review the main application documentation
- Check Django and React documentation
- Test API endpoints individually